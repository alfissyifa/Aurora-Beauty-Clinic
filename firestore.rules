/**
 * Core Philosophy: This ruleset enforces a clear separation between public, read-only data and private, backend-managed data. 
 * The primary goal is to expose catalog-like information (services, testimonials) to all clients while completely protecting
 * sensitive booking information (appointments) from any client-side access.
 *
 * Data Structure: The data is organized into three distinct, top-level collections: /services, /testimonials, and /appointments. 
 * There are no user-specific subcollections or nested data structures, which simplifies the security model.
 *
 * Key Security Decisions:
 * - Public Read-Only Collections: /services and /testimonials are configured to be publicly readable by anyone, including unauthenticated users. 
 *   All write operations (create, update, delete) from client applications are explicitly denied to ensure data integrity.
 * - Backend-Only Collection: The /appointments collection is completely locked down. No client-side reads or writes are permitted. 
 *   This enforces the principle that appointment data can only be created or managed by trusted backend processes (e.g., Cloud Functions) using the Admin SDK, which bypasses these rules.
 * - No User Ownership: This security model does not rely on user authentication for its decisions, as the data is either public or backend-managed.
 *
 * Denormalization for Authorization: Not applicable in this model, as there are no user-specific authorization requirements.
 *
 * Structural Segregation: The use of separate top-level collections for public data (/services, /testimonials) and private data (/appointments) 
 * is a core part of the security design. This prevents any possibility of a client accidentally querying for or accessing protected data.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Helper Functions
    
    /**
     * Checks if a user is authenticated.
     */
    // function isSignedIn() {
    //   return request.auth != null;
    // }

    /**
     * @description   Allows public read-only access to beauty service information.
     * @path          /services/{serviceId}
     * @allow         Any user, authenticated or not, can read a specific service. (get)
     * @deny          A client attempts to create a new service. (create)
     * @principle     Secures the collection as read-only for all clients to maintain data integrity.
     */
    match /services/{serviceId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description   Allows public read-only access to customer testimonials.
     * @path          /testimonials/{testimonialId}
     * @allow         Any user, authenticated or not, can list all testimonials. (list)
     * @deny          A client attempts to update an existing testimonial. (update)
     * @principle     Secures the collection as read-only for all clients to maintain data integrity.
     */
    match /testimonials/{testimonialId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description   Stores private appointment data. This collection is completely locked down from client access.
     * @path          /appointments/{appointmentId}
     * @allow         No client-side operation is ever permitted.
     * @deny          Any client attempts to create a new appointment for themselves. (create)
     * @principle     Enforces a strict backend-only access model, protecting sensitive customer booking information.
     */
    match /appointments/{appointmentId} {
      allow get: if false;
      allow list: if false;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }
  }
}